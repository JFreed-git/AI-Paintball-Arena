<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paintball Arena</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="gameContainer">
        <!-- Round UI (moved outside #ui so fixed positioning uses viewport) -->
        <div id="roundBanner" class="hidden"></div>
        <div id="roundCountdown" class="hidden"></div>
        <div id="respawnHeroPrompt" class="hidden">Press H to change hero</div>
        <div id="ui">

            <!-- Enemy Health HUD (top-right, AI mode only) -->
            <div id="enemyHealthContainer" class="hidden">
                <div class="label">Enemy</div>
                <div id="enemyHealthBar">
                    <div id="enemyHealthFill" style="width: 100%"></div>
                </div>
            </div>

            <!-- Paintball HUD -->
            <div id="healthContainer" class="hidden">
                <div id="weaponNameDisplay" class="hidden"></div>
                <div id="sprintIndicator" class="hidden">SPRINTING</div>
                <div id="healthBar">
                    <div id="healthFill" style="width: 100%"></div>
                </div>
                <div id="ammoRow">
                    <span id="ammoDisplay">0/0</span>
                    <span id="reloadIndicator" class="hidden">Reloading...</span>
                    <div id="meleeCooldown" class="hidden">
                        <svg width="26" height="26" viewBox="0 0 26 26">
                            <circle class="melee-cd-bg" cx="13" cy="13" r="11" />
                            <circle class="melee-cd-fill" cx="13" cy="13" r="11" />
                        </svg>
                        <span class="melee-cd-label">V</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="mainMenu" class="menu">
            <h1>Paintball Arena</h1>
            <div class="field">
                <label for="playerNameInput">Player Name</label>
                <input type="text" id="playerNameInput" maxlength="20" placeholder="Enter your name">
            </div>
            <div class="field">
                <label for="sensInput">Mouse Sensitivity</label>
                <input type="range" id="sensInput" min="0.2" max="3" step="0.1" value="1.0">
                <span id="sensValue">1.0</span>
            </div>
            <div class="field">
                <label for="fovInput">Field of View</label>
                <input type="range" id="fovInput" min="50" max="110" step="1" value="75">
                <span id="fovValue">75</span>
            </div>
            <div class="actions">
                <button id="gotoStartGame">Start Game</button>
                <button id="gotoTraining" class="secondary">Training Range</button>
            </div>
        </div>

        <div id="startGameMenu" class="menu-screen hidden">
            <h2>Start Game</h2>
            <div class="actions start-game-actions">
                <button id="gotoHostGame">Host Game</button>
                <button id="gotoJoinGame" class="secondary">Join Game</button>
            </div>
            <div id="joinRoomSection" class="hidden">
                <div class="field">
                    <label>Room Code
                        <input type="text" id="joinRoomCode" placeholder="Enter room code" maxlength="10" />
                    </label>
                </div>
                <div id="joinRoomError" class="join-error hidden"></div>
                <div class="actions">
                    <button id="joinRoomSubmit">Join</button>
                </div>
            </div>
            <div class="actions" style="margin-top: 12px;">
                <button id="backFromStartGame" class="secondary">Back</button>
            </div>
        </div>

        <div id="trainingMenu" class="menu hidden">
            <h2>Training Range</h2>
            <div class="actions">
                <button id="startTraining">Start Training</button>
                <button class="secondary" id="backFromTraining">Back</button>
            </div>
        </div>

        <div id="lobbyMenu" class="menu-screen hidden">
            <div class="lobby-header">
                <h2>Game Lobby</h2>
                <div class="lobby-info">
                    <span class="lobby-map-name" id="lobbyMapName">Default Arena</span>
                    <span class="lobby-mode-badge" id="lobbyModeBadge">FFA</span>
                </div>
                <div class="lobby-room-id">Room Code: <span id="lobbyRoomId">---</span></div>
            </div>
            <div class="lobby-body">
                <div class="lobby-players">
                    <h3>Players</h3>
                    <div id="lobbyPlayerList">
                        <!-- JS populates slots dynamically based on map maxPlayers -->
                    </div>
                </div>
            </div>
            <div class="lobby-actions">
                <button id="lobbyStartBtn" class="lobby-start">Start Game</button>
                <button id="lobbyReadyBtn" class="lobby-ready hidden">Ready</button>
                <button id="lobbyBackBtn" class="secondary">Back</button>
            </div>
        </div>

        <div id="gameSetupMenu" class="menu-screen hidden">
            <div class="setup-header">
                <button id="setupBack" class="setup-back-btn">&larr; Back</button>
                <h2>Game Setup</h2>
            </div>
            <div class="setup-body">
                <div class="setup-maps">
                    <h3>Select Map</h3>
                    <div id="mapGrid" class="map-grid">
                        <!-- Map cards populated dynamically by JS (Task 041) -->
                    </div>
                </div>
                <div class="setup-settings">
                    <h3>Match Settings</h3>
                    <div class="field">
                        <label>Mode</label>
                        <select id="setupMode">
                            <option value="ffa" selected>Free-For-All</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>Rounds to Win</label>
                        <input type="number" id="setupRounds" value="3" min="1" max="10" />
                    </div>
                    <div class="field">
                        <label><span id="setupWinLabel">Kill Limit</span></label>
                        <input type="number" id="setupKillLimit" value="10" min="1" max="50" />
                    </div>
                    <div class="field">
                        <label><input type="checkbox" id="setupNoRespawns" /> No Respawns (Elimination)</label>
                    </div>
                </div>
            </div>
            <div class="setup-actions">
                <button id="setupCreateGame" class="setup-create-btn">Create Game</button>
                <button id="setupBackBottom" class="secondary">Back</button>
            </div>
        </div>

        <div id="resultMenu" class="menu hidden">
            <h2>Session Complete</h2>
            <p style="text-align:center;margin:10px 0 20px;">Final Score: <strong><span id="finalScore">0</span></strong></p>
            <div class="actions">
                <button id="backToMenu">Back to Main Menu</button>
            </div>
        </div>

        <div id="trainingStats" class="hidden">
            Shots: <span id="tsShotCount">0</span><br>
            Hits: <span id="tsHitCount">0</span><br>
            Kills: <span id="tsKillCount">0</span><br>
            Accuracy: <span id="tsAccuracy">-</span>
        </div>

        <div id="heroSelectOverlay" class="hidden">
            <div id="heroSelectTitle">SELECT HERO</div>
            <div id="heroSelectTimer" class="hidden">15</div>
            <div id="heroSelectWaiting" class="hidden">Waiting for opponent...</div>
            <div id="heroSelectHint">Press H to close</div>
        </div>

        <!-- Scoreboard Overlay (shown when Tab held during FFA gameplay) -->
        <div id="scoreboardOverlay" class="hidden">
            <div id="scoreboardTitle">SCOREBOARD</div>
            <div id="scoreboardTable">
                <div class="scoreboard-header">
                    <span class="sb-rank">#</span>
                    <span class="sb-player">Player</span>
                    <span class="sb-hero">Hero</span>
                    <span class="sb-kills">Kills</span>
                    <span class="sb-deaths">Deaths</span>
                    <span class="sb-score">Score</span>
                </div>
                <div id="scoreboardRows">
                    <!-- JS populates rows here. Each row structure:
                    <div class="scoreboard-row [sb-local]">
                        <span class="sb-rank">1</span>
                        <span class="sb-player">PlayerName</span>
                        <span class="sb-hero">Marksman</span>
                        <span class="sb-kills">5</span>
                        <span class="sb-deaths">2</span>
                        <span class="sb-score">500</span>
                    </div>
                    Use .sb-local class to highlight the local player's row.
                    -->
                </div>
            </div>
        </div>

        <!-- Post-Match Results (shown after FFA match ends) -->
        <div id="postMatchResults" class="menu-screen hidden">
            <h2 id="postMatchHeader">Match Over</h2>
            <div id="postMatchWinner"></div>
            <div id="postMatchScoreboard">
                <div class="scoreboard-header">
                    <span class="sb-rank">#</span>
                    <span class="sb-player">Player</span>
                    <span class="sb-hero">Hero</span>
                    <span class="sb-kills">Kills</span>
                    <span class="sb-deaths">Deaths</span>
                    <span class="sb-score">Score</span>
                </div>
                <div id="postMatchRows">
                    <!-- JS populates final scoreboard rows here (same structure as scoreboardRows) -->
                </div>
            </div>
            <div class="actions">
                <button id="postMatchToLobby">Back to Lobby</button>
                <button id="postMatchToMenu" class="secondary">Back to Menu</button>
            </div>
        </div>

        <div id="devConsole" class="hidden">
            <div id="devPassword">
                <h3>Dev Console</h3>
                <input type="password" id="devPasswordInput" placeholder="Enter password" autocomplete="off" />
                <button id="devPasswordSubmit">Submit</button>
                <div id="devPasswordError" class="hidden">Wrong password</div>
            </div>
            <div id="devCommands" class="hidden">
                <h3>Dev Console</h3>
                <button class="dev-cmd" data-cmd="godMode">God Mode: OFF</button>
                <button class="dev-cmd" data-cmd="unlimitedAmmo">Unlimited Ammo: OFF</button>
                <button class="dev-cmd" data-cmd="spectator">Spectator Camera: OFF</button>
                <button class="dev-cmd" data-cmd="killEnemy">Kill Enemy</button>
                <button class="dev-cmd" data-cmd="heal">Heal Player</button>
                <button class="dev-cmd" data-cmd="showHitboxes">Show Hitboxes: OFF</button>
                <button class="dev-cmd" data-cmd="showAIState">AI State: OFF</button>
            </div>
        </div>
    </div>

    <!-- External libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <!-- Core systems (no game-mode dependencies) -->
    <script src="config.js"></script>
    <script src="audio.js"></script>
    <script src="weapon.js"></script>
    <script src="weaponModels.js"></script>
    <script src="physics.js"></script>
    <script src="crosshair.js"></script>
    <script src="hud.js"></script>
    <script src="roundFlow.js"></script>
    <script src="heroes.js"></script>
    <script src="abilities.js"></script>
    <script src="heroSelectUI.js"></script>

    <!-- Menu system -->
    <script src="menuRenderer.js"></script>

    <!-- Input, UI, environment -->
    <script src="input.js"></script>
    <script src="environment.js"></script>

    <!-- Player and arenas -->
    <script src="player.js"></script>
    <script src="arenaBuilder.js"></script>
    <script src="arenaCompetitive.js"></script>
    <script src="arenaTraining.js"></script>
    <script src="mapFormat.js"></script>
    <script src="mapThumbnail.js"></script>

    <!-- Menu navigation (after mapFormat/mapThumbnail which it depends on) -->
    <script src="menuNavigation.js"></script>

    <!-- Combat and AI -->
    <script src="projectiles.js"></script>
    <script src="aiOpponent.js"></script>
    <script src="trainingBot.js"></script>

    <!-- Game modes -->
    <script src="modeTraining.js"></script>
    <script src="modeFFA.js"></script>
    <script src="ffaScoreboard.js"></script>

    <!-- Bootstrap and dev tools (must be last) -->
    <script src="game.js"></script>
    <script src="devConsole.js"></script>
</body>
</html>
